<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="csrf-token" content={get_csrf_token()} />

    <title><%= @post.meta_title || @post.title %> - Mikael Weiss</title>
    <meta name="description" content={@post.meta_description || @post.excerpt || String.slice(@post.content, 0, 160)} />

    <meta property="og:title" content={@post.meta_title || @post.title} />
    <meta property="og:description" content={@post.meta_description || @post.excerpt || String.slice(@post.content, 0, 160)} />
    <meta property="og:type" content="article" />
    <meta property="og:url" content={"#{PortfolioTemplateWeb.Endpoint.url()}/blog/#{@post.slug}"} />
    <%= if @post.cover_image_path do %>
      <meta property="og:image" content={PortfolioTemplateWeb.Endpoint.url() <> @post.cover_image_path} />
    <% end %>

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content={@post.meta_title || @post.title} />
    <meta name="twitter:description" content={@post.meta_description || @post.excerpt || String.slice(@post.content, 0, 160)} />
    <%= if @post.cover_image_path do %>
      <meta name="twitter:image" content={PortfolioTemplateWeb.Endpoint.url() <> @post.cover_image_path} />
    <% end %>

    <meta property="article:published_time" content={@post.published_at} />
    <meta property="article:modified_time" content={@post.last_updated} />
    <meta property="article:author" content="Mikael Weiss" />

    <link phx-track-static rel="stylesheet" href={~p"/assets/app.css"} />
    <script defer phx-track-static type="text/javascript" src={~p"/assets/app.js"}>
    </script>

    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "headline": "<%= @post.title %>",
        "description": "<%= @post.excerpt || String.slice(@post.content, 0, 160) %>",
        "author": {
          "@type": "Person",
          "name": "Mikael Weiss"
        },
        "datePublished": "<%= @post.published_at %>",
        "dateModified": "<%= @post.last_updated %>",
        <%= if @post.cover_image_path do %>
        "image": "<%= PortfolioTemplateWeb.Endpoint.url() <> @post.cover_image_path %>",
        <% end %>
        "publisher": {
          "@type": "Person",
          "name": "Mikael Weiss"
        }
      }
    </script>

    <script>
      if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark')
      } else {
        document.documentElement.classList.remove('dark')
      }
    </script>
  </head>
  <body class="min-h-screen bg-background-secondary-light dark:bg-background-secondary-dark">
    <div class="max-w-5xl mx-auto px-6 sm:px-8 py-12 sm:py-16">
      <nav class="mb-12">
        <a
          href={~p"/blog"}
          class="inline-flex items-center gap-2 text-text-secondary-light dark:text-text-secondary-dark hover:text-brand dark:hover:text-brand-light font-medium transition-colors duration-200 group"
        >
          <svg class="w-5 h-5 transition-transform duration-200 group-hover:-translate-x-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
          </svg>
          <span>Back to blog</span>
        </a>
      </nav>

      <article>
        <header class="mb-12">
          <h1 class="text-4xl sm:text-5xl font-semibold text-text-primary-light dark:text-text-primary-dark mb-6 tracking-tight leading-tight">
            <%= @post.title %>
          </h1>

          <div class="flex items-center gap-3 text-sm text-text-tertiary-light dark:text-text-tertiary-dark">
            <span class="font-medium text-text-secondary-light dark:text-text-secondary-dark">Mikael Weiss</span>
            <span class="w-1 h-1 rounded-full bg-text-tertiary-light dark:bg-text-tertiary-dark"></span>
            <time datetime={@post.published_at} class="font-medium">
              <%= format_date(@post.published_at) %>
            </time>
            <span class="w-1 h-1 rounded-full bg-text-tertiary-light dark:bg-text-tertiary-dark"></span>
            <span><%= reading_time(@post.content) %></span>
          </div>
        </header>

        <%= if @post.cover_image_path do %>
          <div class="mb-12 -mx-6 sm:mx-0">
            <div class="aspect-[21/9] sm:aspect-[21/10] overflow-hidden sm:rounded-2xl bg-background-tertiary-light dark:bg-background-tertiary-dark shadow-xl">
              <img
                src={@post.cover_image_path}
                alt={@post.title}
                class="w-full h-full object-cover"
              />
            </div>
          </div>
        <% end %>

        <div class="prose-refined">
          <%= raw(Earmark.as_html!(@post.content)) %>
        </div>

        <footer class="mt-16 pt-12 border-t border-border-light dark:border-border-light-dark">
          <div class="card-refined p-6">
            <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
              <p class="text-sm text-text-secondary-light dark:text-text-secondary-dark">
                Subscribe to get notified when I publish new posts
              </p>
              <.form :let={_f} for={%{}} action={~p"/subscribe"} method="post" class="flex gap-3 flex-shrink-0">
                <input
                  type="email"
                  name="email"
                  placeholder="your@email.com"
                  required
                  class="input-refined w-64"
                />
                <button
                  type="submit"
                  class="btn-primary whitespace-nowrap"
                >
                  Subscribe
                </button>
              </.form>
            </div>
          </div>
        </footer>
      </article>
    </div>
  </body>
</html>
